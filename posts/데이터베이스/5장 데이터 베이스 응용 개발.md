# 5장 데이터 베이스 응용 개발

데이터베이스를 이용할 때 사용되는 SQL은 개발자만 사용할 뿐 대부분의 데이터베이스 사용자들은 SQL을 사용하지 않습니다. 일반 사용자들은 개발자가 만든 응용 프로그램을 통해 데이터베이스를 이용합니다.

## 데이터 베이스의 응용 구조

데이터 베이스 응용 구조는 크게 3가지로 나뉩니다.

- Front-end
- Middle layer
- Backend

## Front-end

Front-end는 사용자가 조작하는 유저 인터페이스(UI)로서 Form과 Report generator를 지원합니다. 다양한 유저 인터페이스가 존재하지만 요즘은 Web 기반의 인터페이스가 널리 사용되고 있습니다.

### Form

<p align="center"><img src="../../images/데이터베이스/5장 데이터 베이스 응용 개발-Untitled.png"></p>

Form은 UI로서 DB에 데이터를 입력하고 조회하는 목적으로 사용됩니다. 네이버의 검색 창과 같은 것이 Form에 해당합니다.

### Report generator

<p align="center"><img src="../../images/데이터베이스/5장 데이터 베이스 응용 개발-Untitled 1.png"></p>

Report generator는 DB에서 사용자가 원하는 보고서를 용도에 맞게 생성하는 도구입니다. 보고서에는 각종 통계 정보가 포함된 표 또는 그래프가 포함됩니다. 대부분의 Form 개발 도구들이 보고서 생성 기능을 지원하여 보고서를 쉽게 만들 수 있습니다.

## Web Interface

Web browser는 DB 응용에 대한 사실상 표준이라고 봐도 무방할 정도로 널리 사용되고 있습니다. Web Interface는 다음과 같은 특징을 가지고 있습니다.

- Universal front end
    
    언제 어디서든 웹 브라우저가 깔린 환경이라면 동일한 Web Interface를 사용할 수 있습니다.
    
- 동적 Web page 생성
    
    Web page는 고정된 구조인 HTML과 컨텐츠를 생성하는 프로그램(Javascript 등)으로 만들어집니다. 이러한 특징으로 인해 사용자는 프로그래머가 사전 정의한 정적 page를 보는 것이 아닌 사용자의 요청에 따라 동적으로 생성된 Web page를 보게 됩니다. 
    
- HTML과 Hyperlink의 활용
    
    HTML과 Hyperlink를 활용하여 깔끔하고 이해하기 쉬운 UI를 구현할 수 있습니다.
    
- HTML문서에 포함된 고사양 프로그램 활용 가능
    
    Javascrpit 등을 활용하여 애니메이션 기능 등의 고급 기능을 사용할 수 있습니다.
    

### URL

URL은 Web에서 포인터 역할을 합니다. 예를 들어 [http://www.naver.com/login](http://www.naver.com/login)이라는 URL이 있을 때 구성요소를 하나하나 분석하면 다음과 같습니다.

- http : 문서를 액세스하는 프로토콜
- [www.naver.com](http://www.naver.com) : Internet에서 machine의 고유한 이름
- login : machine에서 문서를 표시. 즉, 프로그램 이름


또한 [http://www.naver.com/search?q=Keyword](http://www.naver.com/search?q=Keyword)와 같이 search 프로그램을 실행하는데 있어 필요한 매개 변수를 지정해줄 수도 있습니다.

<aside>
💡 search?q=Keyword → search라는 프로그램을 실행하는데 있어 q라는 매개변수에 Keyword를 넣는다.

</aside>

### HTML

HTML은 Text formatting, Hypertext link, 이미지 출력 등을 지원하는 문서입니다. Web browser는 HTML을 읽고 해석하여 사용자에게 HTML에 맞는 화면을 출력합니다. 

Web browser가 Web server와 HTML을 주고 받을 때 HTTP을 사용합니다. 이때 HTML을 주고받는 방법에는 2가지가 있습니다.

- get method
    
    프로그램 실행에 필요한 매개 변수를 URL에 같이 첨부하여 요청함
    
    주로 Request에 사용
    
    e.g. [http://www.naver.com/search?q=Keyword](http://www.naver.com/search?q=Keyword) 
    
- post method
    
    프로그램 실행에 필요한 매개변수를 HTTP 프로토콜의 부분으로 전송함
    
    주로 Result에 사용
    
    e.g. [http://www.naver.com/](http://www.naver.com/) 
    

로그인을 하기 위해 서버로 ID, PW를 보낼 때 get method를 사용하면 URL에 민감한 정보가 포함이 되므로 보안에 취약합니다. 이럴 땐 post method를 사용하여 민감한 정보를 숨길 수 있습니다. 반대로 검색 결과 요청과 같이 보안이 필요없는 요청은 get method를 활용하여 서버에 요청을 보냅니다.

**예시**

<p align="center"><img src="../../images/데이터베이스/5장 데이터 베이스 응용 개발-Untitled 2.png"></p>

```html
<html>
<body>
    <table border="1">
        <tr>
            <td>A-101</td>
            <td>Downtown</td>
            <td>500</td>
        </tr>
        <tr>
            <td>A-102</td>
            <td>Perryridge</td>
            <td>400</td>
        </tr>
        <tr>
            <td>A-201</td>
            <td>Brighton</td>
            <td>900</td>
        </tr>
    </table>
    The <i>account</i> relation
    <form action="BankQuery" method=get>
        Select account/loan and enter number <br>
        <select name="type">
            <option value="account" selected> Account </option>
            <option value="loan"> Loan </option>
        </select>
        <input type=text size=5 name="number">
        <input type=submit value="submit">
    </form>
</body>

</html>
```

## Web server

Web server는 총 3가지가 있습니다.

- Web server
    
    사용자의 요청에 응답하는 곳. 사용자가 프로그램을 요청한 경우 Web application server의 프로그램을 실행함
    
- Web Application Sever(WAS)
    
    Web의 프로그램을 수행하는 곳. login과 같은 복잡한 작업 수행하고 Web server에 결과를 반환
    
- Database server

<p align="center"><img src="../../images/데이터베이스/5장 데이터 베이스 응용 개발-Untitled 3.png"></p>

Web 이용자가 많을 경우 Web server와 WAS를 별도의 서버로 구현하고, 그렇지 않을 경우 하나의 서버를 Web server와 WAS로 사용합니다.

### HTTP

http는 비연결성 프로토콜로서 클라이언트가 서버에 요청을 하면 서버는 요청에 대해 응답을 한 후 클라이언트와 접속을 종료합니다. http가 이러한 특징을 가지는 이유는 동시에 접속 가능한 클라이언트 수를 제한하여 서버에 대한 부하를 줄이기 위함입니다.

그러나 login 정보를 비연결적으로 처리할 경우 모든 요청마다 login을 해야하는 비효율적인 상황이 발생할 수 있습니다. 이를 해결하기 위한 것이 Cookie와 Session입니다.

### Cookie

Cookie는 문자열 정보로서 인터넷 접속 정보를 브라우저에 저장합니다.

- Server → Browser
    
    첫 번째 접속에서 생성된 세션에 관한 기록을 서버에 전송받아 브라우저에 저장
    
- Browser → Server
    
    동일한 세션에 대한 추가 interaction시 HTTP의 일부로 전송
    

그러나 인터넷 접속 정보를 브라우저에 저장한다는 보안 문제점이 있습니다. 이를 해결하기 위한 것이 Session입니다.

### Session

Session은 인터넷 접속 정보를 Web server의 Web container에 저장하는 것을 말합니다. Web server에 Web browser 마다 하나의 Session이 생성되고 각 Session은 고유한 Session ID를 부여받습니다. 인터넷 접속 정보가 브라우저가 아닌 Web server에 저장되므로 Cookie에 비해 보안에 유리하다는 장점이 있습니다.

## Client-Side Scripting

사용자가 웹 페이지에서 로그인 하는 경우를 생각해봅시다. 사용자가 아이디와 비밀번호를 입력한 후 로그인 버튼을 누르면 웹 서버에 로그인 요청을 보낼 수 있습니다. 로그인 요청을 받은 웹 서버는 로그인 정보를 로그인 프로그램에 넘긴 후 로그인 프로그램의 반환 값을 HTML로 변환하여 사용자에게 전달합니다.

그런데 아이디에 특수문자가 들어가면 어떻게 될까요? 일반적인 웹 사이트는 아이디에 특수문자를 허락하지 않습니다. 따라서 아이디에 특수문자를 넣고 로그인 버튼을 누르면 로그인 실패가 뜨는데요 이러한 작업을 서버에서 한다면 서버에 부담이 갈 수 있습니다.

이를 해결하고자 Client-Side Scripting을 사용합니다. 아이디 데이터의 무결성 검사와 같은 작업은 사용자 쪽에서 해결하자는 것이죠. 즉, Web browser에서 무결성 검사를 한다는 것입니다.

Client-Side Scripting은 Javascript와 같은 언어로 처리할 수 있는데요. 앞서 말한 Client-side Scripting을 활용하면 앞서 말한 무결성 검사와 같이 사용자 입력에 대한 빠른 응답이 가능할 뿐만 아니라 애니메이션과 같은 HTML의 한계를 넘어선 Flexible UI도 제공할 수 있습니다.

## Server-side Scripting

Client-side scripting은 앞서 말한 Client-side scripting과 달리 서버 측에서 작업을 처리하는 것을 말합니다. Server-side scripting은 Servlet, JSP와 같은 언어로 처리할 수 있습니다.

Servlet는 Database를 이용한 Web programming 기술입니다. HTTP 요청에 대한 응답을 동적으로 생성합니다. HTML 생성 과정은 아래와 같습니다.

1. HTML form에서 입력된 인자를 받아들임
2. 인자를 통해 어떤 응답을 생성할 지 결정
3. Browser에 반환할 HTML을 생성

### Servlet

Servlet은 WAS(Web application server)안에서 동작합니다. Web application server의 역할은 아래와 같습니다.

- 요청을 담당할 servlet을 실행하고 실행 결과를 client에게 반환
    
    이때, 각 요청은 thread로 생성되어 여러 요청이 동시에 실행될 수 있어 빠르며 여러 thread들이 하나의 데이터를 공유할 수 있습니다.
    
- Servlet code가 변경될 경우 재컴파일하여 server에 로드

**Servlet 예시**

```java
public class BankQuery extends HttpServlet {

    public void doGet(HttpServletRequest request, HttpServletResponse result) throws ServletException, IOException{
        String type = request.getParameter("type");
        String number = request.getParameter("number");
        
        /*
         * …code to find the loan amount/account balance …
         * …using JDBC to communicate with the database..
         * …we assume the value is stored in the variable balance
         */

        result.setContentType("text/html");
        PrintWriter out = result.getWriter( );
        out.println("<HEAD><TITLE>Query Result</TITLE></HEAD>");
        out.println("<BODY>");
        out.println("Balance on  " + type + number + "=" + balance);
        out.println("</BODY>");
        out.close ( );
    }

}
```

### JSP

JSP는 Servlets과 동일한 역할을 수행하지만 HTML 기반으로 만들어져 Servlets보다 프로그래머가 작성하기 쉽게 만들어져있습니다. JSP을 컴파일하면 Servlet이 됩니다.

**JSP 예시**

```html
<html>
<head> <title> Hello </title> </head>
<body>
<% if (request.getParameter(“name”) == null){ 
    out.println(“Hello World”); 
}
else { out.println(“Hello, ” + request.getParameter(“name”)); }
%>
</body>
</html>
```