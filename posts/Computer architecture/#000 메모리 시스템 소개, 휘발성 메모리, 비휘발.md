# #000 메모리 시스템 소개, 휘발성 메모리, 비휘발성 메모리

이번 글에서는 메모리 시스템에 대하여 알아보도록 하겠습니다.

## 메모리 시스템 구조

일반적인 메모리 시스템 구조는 아래와 같습니다.

<p align="center"><img src="../../images/Computer architecture/%23000%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%86%8C%EA%B0%9C%2C%20%ED%9C%98%EB%B0%9C%EC%84%B1%20%EB%A9%94%EB%AA%A8%EB%A6%AC%2C%20%EB%B9%84%ED%9C%98%EB%B0%9C/Untitled.png"></p>

빠른 처리 속도를 갖는 CPU와 이에 비해 느린 속도의 Memory의 병목 현상을 해결하기위해 계층적인 메모리 구조를 갖습니다.

CPU와 가까워질수록 크기는 작아지고 속도는 빠르며 가격은 비싸집니다. 반대로, CPU와 멀어질수록 크기는 커지고 속도는 느려지며 가격은 싸집니다.

일반적으로 컴퓨터는 `CPU - 캐시 메모리 - 메인 메모리 - 저장소`의 구조를 갖습니다.

## 메모리의 종류

메모리는 크게 전원을 껐을 때 데이터가 남아있는지에 따라 2가지로 나뉩니다.

- 휘발성 메모리
- 비휘발성 메모리

### 휘발성 메모리

휘발성 메모리는 메모리의 전원을 끄면 데이터가 날아지는 메모리입니다. 휘발성 메모리의 대표적인 예는 RAM$^{Random\ Access\ Memory}$이 있습니다.

**Random Access**란 메모리의 임의 위치에 대한 접근을 말합니다. RAM은 이러한 Random Access을 할 때 메모리의 모든 위치에 대하여 접근 속도가 같습니다. 즉, RAM은 항상 데이터 접근 시간이 같은 메모리입니다.

RAM은 DRAM과 SRAM으로 나뉩니다. 각 특징은 아래와 같습니다.

- DRAM$^{Dynamic\ Random\ Access\ Memory}$
    - 높은 밀집도(하나의 셀에 1개의 트랜지스터)
    - 낮은 전력
    - 싼 가격
    - 느린 속도
- SRAM$^{Static\ Random\ Access\ Memory}$
    - 낮은 밀집도(하나의 셀에 6개의 트랜지스터)
    - 높은 전력
    - 비싼 가격
    - 빠른 속도

**Dynamic**의 의미는 Refresh가 필요하다는 뜻입니다. DRAM은 커패시터로 구성되어있는데 커패시터는 일정 시간이 지나면 방전이 됩니다. 따라서 데이터를 쓰고난 후 시간이 지나면 데이터를 잃어버리기 때문에 Refresh를 통해 데이터를 갱신할 필요가 있습니다. 일반적으로 Refresh는 4~8ms마다 발생합니다.

이에 반해, **Static**은 저장된 데이터가 영구적으로 저장됩니다. 하지만 휘발성 메모리이므로 전원이 꺼지면 데이터를 잃습니다. 즉, 전원이 켜져 있는 한 데이터를 영구적으로 저장하고 있다는 뜻이죠.

DRAM은 메인 메모리에 사용되며, SRAM은 캐시 메모리에 사용됩니다.

<p align="center"><img src="../../images/Computer architecture/%23000%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%86%8C%EA%B0%9C%2C%20%ED%9C%98%EB%B0%9C%EC%84%B1%20%EB%A9%94%EB%AA%A8%EB%A6%AC%2C%20%EB%B9%84%ED%9C%98%EB%B0%9C/Untitled%201.png"></p>

DRAM의 발전은 위와 같습니다. 시간이 지남에 따라 대역폭$^{bandwidth}$는 2배 이상씩 증가하였으나 지연 속도$^{latency}$의 발전 속도는 더뎠습니다. I/O 지연 속도를 줄이는 것이 쉽지 않자 한 번의 I/O에 보내는 데이터 양을 늘리는 방식으로 발전한 것입니다.

<p align="center"><img src="../../images/Computer architecture/%23000%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%86%8C%EA%B0%9C%2C%20%ED%9C%98%EB%B0%9C%EC%84%B1%20%EB%A9%94%EB%AA%A8%EB%A6%AC%2C%20%EB%B9%84%ED%9C%98%EB%B0%9C/Untitled%202.png"></p>

위 표는 또 다른 DRAM의 발전을 나타냅니다. 위 표에서 봤던 것처럼 지연 속도를 줄이는 것은 쉽지 않습니다. 그러나 같은 행에서 열 이동의 속도는 많이 줄었습니다. 이로 인해 DRAM은 데이터를 행 단위로 저장하기 시작합니다.

### 비휘발성 메모리

비휘발성 메모리는 메모리의 전원을 끄더라도 데이터가 남아있는 메모리입니다. 현재 사용되는 비휘발성 메모리에는 HDD$^{Hard\ Disk\ Drive}$와 SDD$^{Solid\ State\ Drive}$가 있습니다.

**HDD**는 자기장의 원리로 자성 물질이 있는 원판에 자기를 정렬하는 원리로 데이터를 기록하고 지웁니다. 또한, HDD는 섹터$^{sector}$라는 단위로 구성되어 있습니다. 각각의 섹터는 자신의 섹터 ID를 가지며 고정된 크기를 갖습니다. 또한, 배드 섹터 등의 오류를 감지하는 ECC$^{Error\ Correcting\ Code}$를 가지고 있습니다.

<p align="center"><img src="../../images/Computer architecture/%23000%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%86%8C%EA%B0%9C%2C%20%ED%9C%98%EB%B0%9C%EC%84%B1%20%EB%A9%94%EB%AA%A8%EB%A6%AC%2C%20%EB%B9%84%ED%9C%98%EB%B0%9C/Untitled%203.png"></p>

HDD는 위와 같은 구조를 갖습니다. 헤더라는 물리적 장치가 이동하면서 원판$^{platter}$의 데이터를 읽고 씁니다. 따라서, 읽고 쓸 때 아래와 같은 시간이 생깁니다.

- Seek time : 헤더가 섹터가 위치한 트랙으로 이동하는 시간
    
    > 일반적으로 디스크에 저장되는 데이터는 지역성을 가지기때문에 실제 Seek time은 25%~33% 짧습니다.
    > 
- Rotational latency : 헤더가 트랙에서 찾는 섹터로 이동하는 시간
    
    > Rotational latency는 **반바퀴를 기준으로 계산하여 평균**을 구합니다. 예를 들어, 5400RPM의 하드디스크의 Rotatinal latency는 $\frac{60}{5400}\times\frac{1}{2} = 5.6ms$입니다.
    > 
- Transfer time : 블록의 데이터를 컨트롤러 캐시로 이동하는 시간
    
    > 디스크의 구성 단위는 섹터지만, 디스크 I/O의 단위는 여러 섹터가 모인 블럭입니다.
    > 
- Controller time : 컨트롤러가 제어하는 시간

예를 들어 15,000RPM의 하드디스크의 섹터 크기가 512Byte, 평균 seek time이 4ms, transfer rate가 100MB/s, controller overhead가 0.2ms일 때, 섹터 1개를 읽는 시간은 얼마일까요?

1. 섹터가 위치한 트랙으로 움직이는 시간(Seek time = 4ms)
2. 트랙에서 섹터의 위치로 움직이는 시간(Rotational latency = $\frac{60}{15000}\times\frac{1}{2}$ = 2ms)
3. 섹터 전송 시간(Transfer time = 512/100MB/s = 0.005ms)
4. 컨트롤러 제어 시간(Controller time = 0.2ms) → 상수

총 6.2005ms입니다. 만약, 지역성에 의해 평균 25%의 seek time을 적용하면 seek time이 4ms에서 1ms로 줄어들어 3.2005ms라 할 수 있습니다.